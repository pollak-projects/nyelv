<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    />
    <title>Admin</title>
  </head>
  <body>
    <h1>Admin view</h1>
    <table class="table">
      <thead>
        <tr>
          <th>ID</th>
          <th>USERNAME</th>
          <th>FIRST_NAME</th>
          <th>LAST_NAME</th>
          <th>BIRTH DATE</th>
          <th>EMAIL</th>
          <th>PASSWORD</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <% felhasznalok.forEach(element => { %>
          <th>
            <input id="<%= element.id %>" value="<%= element.id %>" disabled />
          </th>
          <td>
            <input id="<%= element.id %>nev" value="<%= element.username %>" />
          </td>
          <td>
            <input
              id="<%= element.id %>nev"
              value="<%= element.first_name %>"
            />
          </td>
          <td>
            <input id="<%= element.id %>nev" value="<%= element.last_name %>" />
          </td>
          <td>
            <input
              id="<%= element.id %>nev"
              value="<%= element.birth_date %>"
            />
          </td>
          <td>
            <input id="<%= element.id %>nev" value="<%= element.email %>" />
          </td>
          <td>
            <input id="<%= element.id %>nev" value="<%= element.password %>" />
          </td>

          <td>
            <button onclick="DeleteUser('<%= element.id %>')">Törlés</button>
          </td>
          <td>
            <button onclick="UpdateUser('<%= element.id %>')">Módosítás</button>
          </td>
        </tr>
        <% }) %>
      </tbody>
    </table>
  </body>
</html>

<script>
  function AddUser() {
    fetch("http://localhost:3300/user/add", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        username: username,
        first_name: first_name,
        last_name: last_name,
        birth_date: new Date(birth_date),
        email: email,
        password: hashedPwd,
        created_at: new Date(),
        updated_at: new Date(),
      }),
    });
  }

  function UpdateUser(id) {
    const username = document.getElementById(id + "username");
    const email = document.getElementById(id + "email");

    fetch("http://localhost:3300/user/update", {
      method: "PUT",
      headers: {
        "Content-Type": "application/json",
      },

      body: JSON.stringify({
        id: id,
        username: username.value,
        email: email.value,
      }),
    })
      .then((res) => res.json())
      .then((data) => {
        if (data.success) {
          location.reload();
        }
      })
      .catch((error) => console.error("Error:", error));
  }
  function DeleteUser(id) {
    fetch(`http://localhost:3300/user/delete`, {
      method: "DELETE",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        id: id.value,
      }),
    }).then((res) => {
      location.reload();
    });
  }
</script>
